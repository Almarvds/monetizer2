(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{CQWG:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/examples/authentication",function(){return n("ZWtL")}])},ZWtL:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return g}));var s=n("1OyB"),a=n("vuIU"),i=n("Ji7U"),o=n("md7G"),l=n("foSv"),r=n("q1tI"),c=n.n(r),u=n("+ryr"),h=n("q+nx"),p=n("PQhJ"),d=n("CafY"),m=c.a.createElement;function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,s=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(s,arguments,a)}else n=s.apply(this,arguments);return Object(o.a)(this,n)}}var g=function(e){Object(i.a)(n,e);var t=f(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){return m(d.a,this.props,m("h1",{className:"display-2"},"Authentication"),m("p",{className:"lead"},"Authentication in this project is handled by the ",m("a",{href:"https://www.npmjs.com/package/next-auth"},"NextAuth")," library."),m("p",null,"The NextAuth library uses Express and ",m("a",{href:"http://passportjs.org/"},"Passport"),", the most commonly used authentication library for Node.js, to provide support for signing in with email and with services like Facebook, Google and Twitter."),m("p",null,"NextAuth adds Cross Site Request Forgery (CSRF) tokens and HTTP Only cookies, supports univeral rendering and does not require client side JavaScript."),m("p",null,"NextAuth adds session support without using client side accessible session tokens, providing protection against Cross Site Scripting (XSS) and session hijacking, while leveraging localStorage where available to cache non-critical session state for optimal performance in Single Page Apps."),m("p",null,"The ",m("a",{href:"https://www.npmjs.com/package/next-auth"},"NextAuthClient")," for NextAuth is designed for React pages powered by Next.js."),m("p",null,"The example callback page from NextAuth has been extended in this project to automatically return the user to the last page they were on after they have signed in."),m("p",{className:"text-muted font-italic"},"The code for NextAuth was from this project but now exists as module to make it easier to use in other projects."),m("h2",null,"Configuration"),m("p",null,"Basic configuration of this project is handled by creating a ",m("span",{className:"font-weight-bold"},".env")," file in the root of the project."),m("h3",null,"Example .env"),m(u.a,{style:h.atomDark,language:"bash",className:"mb-3"},"SERVER_URL=http://localhost:3000\nMONGO_URI=mongodb://localhost:27017/my-database\nFACEBOOK_ID=\nFACEBOOK_SECRET=\nGOOGLE_ID=\nGOOGLE_SECRET=\nTWITTER_KEY=\nTWITTER_SECRET=\nEMAIL_FROM=username@gmail.com\nEMAIL_SERVER=smtp.gmail.com\nEMAIL_PORT=465\nEMAIL_SECURE=true\nEMAIL_USERNAME=username@gmail.com\nEMAIL_PASSWORD="),m("h3",null,"Configuration Files"),m("p",null,"Configuration of NextAuth in this project is split across three files to make it easier to understand and manage."),m("ul",null,m("li",null,m("a",{href:"https://github.com/iaincollins/nextjs-starter/blob/master/next-auth.config.js"},m("h4",null,"next-auth.config.js")),m("p",null,"Basic configuration of NextAuth is handled in ",m("span",{className:"font-weight-bold"},"next-auth.config.js")),m("p",null,"It is where the ",m("span",{className:"font-weight-bold"},"next-auth.functions.js")," and ",m("span",{className:"font-weight-bold"},"next-auth.providers.js")," files are loaded.")),m("li",null,m("a",{href:"https://github.com/iaincollins/nextjs-starter/blob/master/next-auth.functions.js"},m("h4",null,"next-auth.functions.js")),m("p",null,m("span",{className:"font-weight-bold"},"next-auth.functions.js")," defines functions for user management and sending email."),m("h5",null,"find(",m("span",{className:"text-muted font-italic"},"{ id, email, emailToken, provider: { name, id } }"),")"),m("h5",null,"insert(",m("span",{className:"text-muted font-italic"},"user"),")"),m("h5",null,"update(",m("span",{className:"text-muted font-italic"},"user"),")"),m("h5",null,"remove(",m("span",{className:"text-muted font-italic"},"user"),")"),m("h5",null,"serialize(",m("span",{className:"text-muted font-italic"},"user"),")"),m("h5",null,"deserialize(",m("span",{className:"text-muted font-italic"},"id"),")"),m("h5",null,"sendSignInEmail(",m("span",{className:"text-muted font-italic"},"{ email, link }"),")"),m("p",null,"The example included with this project has methods designed for Mongo DB, but you can edit these methods to use it any database (including relational databases using SQL) without having to edit any other code in the project.")),m("li",null,m("a",{href:"https://github.com/iaincollins/nextjs-starter/blob/master/next-auth.providers.js"},m("h4",null,"next-auth.providers.js")),m("p",null,m("span",{className:"font-weight-bold"},"next-auth.providers.js")," defines a list of supported oAuth providers."),m("p",null,"It includes configuration examples for Facebook, Google and Twitter oAuth, which can easily be copied and replicated to add support for signing in other oAuth providers. For tips on configuring oAuth see ",m("a",{href:"https://github.com/iaincollins/nextjs-starter/blob/master/AUTHENTICATION.md"},"AUTHENTICATION.md")))),m("h2",null,"Using NextAuth in Pages"),m("p",null,"Pages in this project extend from the ",m("span",{className:"font-weight-bold"},"Page")," component in ",m("a",{href:"https://github.com/iaincollins/nextjs-starter/blob/master/components/page.js"},"components/page.js"),"."),m("p",null,"The Page component contains some logic ",m("span",{className:"font-weight-bold"},"getInitialProps()"),", which is a special method triggered on page load with Next.js, to populate ",m("span",{className:"font-weight-bold"},"this.props.session")," with the current session state."),m(u.a,{style:h.atomDark,language:"javascript"},"import React from 'react'\nimport { NextAuth } from 'next-auth/client'\n\nexport default class extends React.Component {\n  static async getInitialProps({req}) {\n    return {\n      session: await NextAuth.init({req}) // Populate 'this.props.session'\n    }\n  }\n}"),m("p",null,"When a page is loaded by client side logic, NextAuth fetches the session state using an AJAX call."),m("p",null,"When a page is Server Side Rendered, NextAuth loads the session state from Express Session by parsing the ",m("span",{className:"font-weight-bold"},"req")," object."),m("p",null,"If a user is signed in ",m("span",{className:"font-weight-bold"},"this.props.session.user")," will contain a user object. If they are not logged in, it will not be set."),m("p",null,"To improve rendering performance, NextAuth will attempt to cache the session state (but not the actual session token) in localStorage when available, to avoid a render-blocking AJAX call to fetch session state every time a page is loaded."),m("p",null,"Combined with <Link> preloading, this allows pages to rendered extremely quickly client side, even when signed in. The caching of session data can be be disabled by setting ",m("span",{className:"font-weight-bold"},"sessionRevalidateAge")," to 0 in ",m("span",{className:"font-weight-bold"},"next-auth.functions.js"),". By default session data is cached for 60 seconds before it revalidates."))}}]),n}(p.a)}},[["CQWG",1,2,7,4,0,3,5,6,8,10]]]);